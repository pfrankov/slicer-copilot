const translations = {
  en: {
    loadingProject: "Loading .3mf project...",
    projectLoaded: "Project loaded successfully",
    projectParseFailed: "Failed to parse .3mf file",
    analyzingSettings: "Analyzing settings with AI...",
    analysisComplete: "AI analysis complete",
    analysisFailed: "AI analysis failed",
    dryRunComplete: "Dry run complete. No file written.",
    writingOutput: "Writing optimized project...",
    writeFailed: "Failed to write output file",
    writeSuccess: "Wrote optimized project to {path}",
    nonInteractiveIntent: "Non-interactive mode: using default intent.",
    llmSystemPromptLabel: "LLM system prompt:",
    llmRequestPayloadLabel: "LLM request payload:",
    fieldHeading: "Field",
    detailsHeading: "Details",
    fileLabel: "File",
    printerLabel: "Printer",
    bedLabel: "Bed",
    filamentLabel: "Filament",
    layoutLabel: "Layout",
    profileLabel: "Profile",
    processLabel: "Process",
    unknownValue: "Unknown",
    profileUnknown: "unknown",
    layoutCounts: "{plates} plate(s) · {objects} object(s)",
    projectSummaryTitle: "Project Summary",
    processLayerDetail: "Layer {value}mm",
    processWallsDetail: "Walls {value}",
    processInfillDetail: "Infill {value}%",
    noChangesApplied: "No changes applied — your settings are already optimal!",
    suggestedChangeSingular: "Suggested Change",
    suggestedChangePlural: "Suggested Changes",
    parameterHeading: "Parameter",
    changeHeading: "Change",
    reasonHeading: "Reason",
    strategyTitle: "Strategy",
    warningsTitle: "Warnings",
    objectLabel: "object",
    selectGoalPrompt: "Select optimization goal",
    notesPromptLabel:
      "Add notes about your model (geometry, material quirks, desired outcome)",
    skipHint: "Press Enter to skip",
    selectedLabel: "Selected:",
    goalBalancedLabel: "Balanced",
    goalBalancedDesc: "Optimal balance of quality, strength, and speed",
    goalFunctionalLabel: "Functional strength",
    goalFunctionalDesc: "Maximize durability and load capacity",
    goalVisualLabel: "Visual quality",
    goalVisualDesc: "Best surface finish and appearance",
    goalDraftLabel: "Draft / speed",
    goalDraftDesc: "Quick print for prototyping",
    goalCustomLabel: "Custom",
    goalCustomDesc:
      "No presets — rely entirely on the user's notes and constraints.",
    unknownParameterWarning: "Unknown parameter {parameter}, skipping.",
    objectNotFoundWarning: "Object {object} not found for change {parameter}.",
    unknownObjectParameterWarning:
      "Unknown parameter {parameter} for object {object}.",
    relativeChangeTypeWarning:
      "Relative change for {parameter} skipped: expected numbers.",
    userSettingLockedWarning:
      "Skipping {parameter}: user-modified setting is protected.",
  },
  ru: {
    loadingProject: "Загрузка проекта .3mf...",
    projectLoaded: "Проект успешно загружен",
    projectParseFailed: "Не удалось разобрать файл .3mf",
    analyzingSettings: "Анализ настроек с помощью ИИ...",
    analysisComplete: "Анализ ИИ завершён",
    analysisFailed: "Не удалось выполнить анализ ИИ",
    dryRunComplete: "Пробный запуск завершён. Файл не записан.",
    writingOutput: "Запись оптимизированного проекта...",
    writeFailed: "Не удалось записать выходной файл",
    writeSuccess: "Оптимизированный проект записан в {path}",
    nonInteractiveIntent:
      "Неинтерактивный режим: используется намерение по умолчанию.",
    llmSystemPromptLabel: "Системный промпт LLM:",
    llmRequestPayloadLabel: "JSON-запрос к LLM:",
    fieldHeading: "Поле",
    detailsHeading: "Детали",
    fileLabel: "Файл",
    printerLabel: "Принтер",
    bedLabel: "Стол",
    filamentLabel: "Филамент",
    layoutLabel: "Компоновка",
    profileLabel: "Профиль",
    processLabel: "Процесс",
    unknownValue: "Неизвестно",
    profileUnknown: "неизвестно",
    layoutCounts: "{plates} платформ(ы) · {objects} модель(ей)",
    projectSummaryTitle: "Сводка проекта",
    processLayerDetail: "Слой {value} мм",
    processWallsDetail: "Стенки {value}",
    processInfillDetail: "Заполнение {value}%",
    noChangesApplied: "Изменений нет — ваши настройки уже оптимальны!",
    suggestedChangeSingular: "предлагаемое изменение",
    suggestedChangePlural: "предлагаемые изменения",
    parameterHeading: "Параметр",
    changeHeading: "Изменение",
    reasonHeading: "Причина",
    strategyTitle: "Стратегия",
    warningsTitle: "Предупреждения",
    objectLabel: "модель",
    selectGoalPrompt: "Выберите цель оптимизации",
    notesPromptLabel:
      "Добавьте заметки о модели (геометрия, особенности материала, желаемый результат)",
    skipHint: "Нажмите Enter, чтобы пропустить",
    selectedLabel: "Выбрано:",
    goalBalancedLabel: "Баланс",
    goalBalancedDesc: "Оптимальный баланс качества, прочности и скорости",
    goalFunctionalLabel: "Прочность",
    goalFunctionalDesc: "Максимальная надёжность и несущая способность",
    goalVisualLabel: "Внешний вид",
    goalVisualDesc: "Лучшее качество поверхности и деталей",
    goalDraftLabel: "Черновик / скорость",
    goalDraftDesc: "Быстрая печать для прототипирования",
    goalCustomLabel: "Custom",
    goalCustomDesc: "Без пресетов — используем только ваш ввод и ограничения.",
    unknownParameterWarning: "Неизвестный параметр {parameter}, пропускаю.",
    objectNotFoundWarning:
      "Объект {object} не найден для изменения {parameter}.",
    unknownObjectParameterWarning:
      "Неизвестный параметр {parameter} для объекта {object}.",
    relativeChangeTypeWarning:
      "Относительное изменение для {parameter} пропущено: нужны числа.",
    userSettingLockedWarning:
      "Пропуск {parameter}: этот параметр изменён пользователем и защищён.",
  },
  es: {
    loadingProject: "Cargando proyecto .3mf...",
    projectLoaded: "Proyecto cargado correctamente",
    projectParseFailed: "No se pudo leer el archivo .3mf",
    analyzingSettings: "Analizando ajustes con IA...",
    analysisComplete: "Análisis de IA completado",
    analysisFailed: "Falló el análisis de IA",
    dryRunComplete:
      "Ejecución en seco completada. No se escribió ningún archivo.",
    writingOutput: "Guardando proyecto optimizado...",
    writeFailed: "No se pudo escribir el archivo de salida",
    writeSuccess: "Proyecto optimizado guardado en {path}",
    nonInteractiveIntent:
      "Modo no interactivo: se usa la intención por defecto.",
    llmSystemPromptLabel: "Prompt del LLM:",
    llmRequestPayloadLabel: "Carga útil para el LLM:",
    fieldHeading: "Campo",
    detailsHeading: "Detalles",
    fileLabel: "Archivo",
    printerLabel: "Impresora",
    bedLabel: "Cama",
    filamentLabel: "Filamento",
    layoutLabel: "Distribución",
    profileLabel: "Perfil",
    processLabel: "Proceso",
    unknownValue: "Desconocido",
    profileUnknown: "desconocido",
    layoutCounts: "{plates} placa(s) · {objects} objeto(s)",
    projectSummaryTitle: "Resumen del proyecto",
    processLayerDetail: "Capa {value}mm",
    processWallsDetail: "Paredes {value}",
    processInfillDetail: "Relleno {value}%",
    noChangesApplied:
      "No se aplicaron cambios: ¡tus ajustes ya están optimizados!",
    suggestedChangeSingular: "cambio sugerido",
    suggestedChangePlural: "cambios sugeridos",
    parameterHeading: "Parámetro",
    changeHeading: "Cambio",
    reasonHeading: "Motivo",
    strategyTitle: "Estrategia",
    warningsTitle: "Advertencias",
    objectLabel: "objeto",
    selectGoalPrompt: "Elige el objetivo de optimización",
    notesPromptLabel:
      "Añade notas sobre tu modelo (geometría, material, resultado deseado)",
    skipHint: "Pulsa Enter para omitir",
    selectedLabel: "Seleccionado:",
    goalBalancedLabel: "Equilibrado",
    goalBalancedDesc: "Equilibrio óptimo de calidad, fuerza y velocidad",
    goalFunctionalLabel: "Resistencia funcional",
    goalFunctionalDesc: "Máxima durabilidad y capacidad de carga",
    goalVisualLabel: "Calidad visual",
    goalVisualDesc: "Mejor acabado y apariencia",
    goalDraftLabel: "Borrador / velocidad",
    goalDraftDesc: "Impresión rápida para prototipos",
    goalCustomLabel: "Personalizado",
    goalCustomDesc:
      "Sin ajustes predefinidos: se basa solo en tus notas y restricciones.",
    unknownParameterWarning: "Parámetro desconocido {parameter}, se omite.",
    objectNotFoundWarning:
      "Objeto {object} no encontrado para el cambio {parameter}.",
    unknownObjectParameterWarning:
      "Parámetro {parameter} desconocido para el objeto {object}.",
    relativeChangeTypeWarning:
      "Cambio relativo para {parameter} omitido: se esperaban números.",
    userSettingLockedWarning:
      "Se omite {parameter}: el ajuste modificado por el usuario está protegido.",
  },
  fr: {
    loadingProject: "Chargement du projet .3mf...",
    projectLoaded: "Projet chargé avec succès",
    projectParseFailed: "Impossible de lire le fichier .3mf",
    analyzingSettings: "Analyse des paramètres avec l'IA...",
    analysisComplete: "Analyse IA terminée",
    analysisFailed: "Échec de l'analyse IA",
    dryRunComplete: "Exécution à blanc terminée. Aucun fichier n'a été écrit.",
    writingOutput: "Écriture du projet optimisé...",
    writeFailed: "Impossible d'écrire le fichier de sortie",
    writeSuccess: "Projet optimisé enregistré dans {path}",
    nonInteractiveIntent:
      "Mode non interactif : intention par défaut utilisée.",
    llmSystemPromptLabel: "Invite système du LLM :",
    llmRequestPayloadLabel: "Payload pour le LLM :",
    fieldHeading: "Champ",
    detailsHeading: "Détails",
    fileLabel: "Fichier",
    printerLabel: "Imprimante",
    bedLabel: "Plateau",
    filamentLabel: "Filament",
    layoutLabel: "Disposition",
    profileLabel: "Profil",
    processLabel: "Processus",
    unknownValue: "Inconnu",
    profileUnknown: "inconnu",
    layoutCounts: "{plates} plateau(x) · {objects} objet(s)",
    projectSummaryTitle: "Résumé du projet",
    processLayerDetail: "Couche {value}mm",
    processWallsDetail: "Parois {value}",
    processInfillDetail: "Remplissage {value}%",
    noChangesApplied:
      "Aucun changement appliqué — vos paramètres sont déjà optimisés !",
    suggestedChangeSingular: "changement suggéré",
    suggestedChangePlural: "changements suggérés",
    parameterHeading: "Paramètre",
    changeHeading: "Changement",
    reasonHeading: "Raison",
    strategyTitle: "Stratégie",
    warningsTitle: "Avertissements",
    objectLabel: "objet",
    selectGoalPrompt: "Choisissez l'objectif d'optimisation",
    notesPromptLabel:
      "Ajoutez des notes sur votre modèle (géométrie, matériau, résultat souhaité)",
    skipHint: "Appuyez sur Entrée pour passer",
    selectedLabel: "Sélectionné :",
    goalBalancedLabel: "Équilibré",
    goalBalancedDesc: "Équilibre optimal entre qualité, force et vitesse",
    goalFunctionalLabel: "Résistance fonctionnelle",
    goalFunctionalDesc: "Durabilité et capacité de charge maximales",
    goalVisualLabel: "Qualité visuelle",
    goalVisualDesc: "Meilleur rendu de surface et apparence",
    goalDraftLabel: "Brouillon / vitesse",
    goalDraftDesc: "Impression rapide pour prototypage",
    goalCustomLabel: "Personnalisé",
    goalCustomDesc: "Aucun préréglage — uniquement vos notes et contraintes.",
    unknownParameterWarning: "Paramètre inconnu {parameter}, ignoré.",
    objectNotFoundWarning:
      "Objet {object} introuvable pour le changement {parameter}.",
    unknownObjectParameterWarning:
      "Paramètre {parameter} inconnu pour l'objet {object}.",
    relativeChangeTypeWarning:
      "Changement relatif pour {parameter} ignoré : nombres attendus.",
    userSettingLockedWarning:
      "Ignoré {parameter} : réglage modifié par l'utilisateur et protégé.",
  },
  de: {
    loadingProject: "Lade .3mf-Projekt...",
    projectLoaded: "Projekt erfolgreich geladen",
    projectParseFailed: "Die .3mf-Datei konnte nicht gelesen werden",
    analyzingSettings: "Analysiere Einstellungen mit KI...",
    analysisComplete: "KI-Analyse abgeschlossen",
    analysisFailed: "KI-Analyse fehlgeschlagen",
    dryRunComplete: "Trockentest abgeschlossen. Keine Datei geschrieben.",
    writingOutput: "Schreibe optimiertes Projekt...",
    writeFailed: "Ausgabedatei konnte nicht geschrieben werden",
    writeSuccess: "Optimiertes Projekt gespeichert unter {path}",
    nonInteractiveIntent:
      "Nicht-interaktiver Modus: Standard-Intent wird verwendet.",
    llmSystemPromptLabel: "LLM-Systemprompt:",
    llmRequestPayloadLabel: "LLM-Payload:",
    fieldHeading: "Feld",
    detailsHeading: "Details",
    fileLabel: "Datei",
    printerLabel: "Drucker",
    bedLabel: "Druckbett",
    filamentLabel: "Filament",
    layoutLabel: "Layout",
    profileLabel: "Profil",
    processLabel: "Prozess",
    unknownValue: "Unbekannt",
    profileUnknown: "unbekannt",
    layoutCounts: "{plates} Platte(n) · {objects} Objekt(e)",
    projectSummaryTitle: "Projektübersicht",
    processLayerDetail: "Schicht {value}mm",
    processWallsDetail: "Wände {value}",
    processInfillDetail: "Füllung {value}%",
    noChangesApplied:
      "Keine Änderungen angewendet — deine Einstellungen sind bereits optimal!",
    suggestedChangeSingular: "vorgeschlagene Änderung",
    suggestedChangePlural: "vorgeschlagene Änderungen",
    parameterHeading: "Parameter",
    changeHeading: "Änderung",
    reasonHeading: "Grund",
    strategyTitle: "Strategie",
    warningsTitle: "Warnungen",
    objectLabel: "Objekt",
    selectGoalPrompt: "Wähle das Optimierungsziel",
    notesPromptLabel:
      "Notizen zum Modell (Geometrie, Materialbesonderheiten, gewünschtes Ergebnis)",
    skipHint: "Zum Überspringen Enter drücken",
    selectedLabel: "Ausgewählt:",
    goalBalancedLabel: "Ausgewogen",
    goalBalancedDesc:
      "Optimale Balance zwischen Qualität, Stärke und Geschwindigkeit",
    goalFunctionalLabel: "Funktionale Stärke",
    goalFunctionalDesc: "Maximale Haltbarkeit und Tragfähigkeit",
    goalVisualLabel: "Optische Qualität",
    goalVisualDesc: "Bestes Oberflächenfinish und Aussehen",
    goalDraftLabel: "Entwurf / Geschwindigkeit",
    goalDraftDesc: "Schneller Druck für Prototypen",
    goalCustomLabel: "Individuell",
    goalCustomDesc:
      "Keine Presets – nur deine Angaben und Einschränkungen zählen.",
    unknownParameterWarning:
      "Unbekannter Parameter {parameter}, wird übersprungen.",
    objectNotFoundWarning:
      "Objekt {object} für Änderung {parameter} nicht gefunden.",
    unknownObjectParameterWarning:
      "Unbekannter Parameter {parameter} für Objekt {object}.",
    relativeChangeTypeWarning:
      "Relative Änderung für {parameter} übersprungen: Zahlen erwartet.",
    userSettingLockedWarning:
      "{parameter} wird übersprungen: vom Benutzer geänderter Wert ist geschützt.",
  },
  zh: {
    loadingProject: "正在加载 .3mf 项目...",
    projectLoaded: "项目加载成功",
    projectParseFailed: "无法解析 .3mf 文件",
    analyzingSettings: "正在使用 AI 分析设置...",
    analysisComplete: "AI 分析完成",
    analysisFailed: "AI 分析失败",
    dryRunComplete: "试运行完成。未写入文件。",
    writingOutput: "正在写入优化后的项目...",
    writeFailed: "输出文件写入失败",
    writeSuccess: "已将优化后的项目写入 {path}",
    nonInteractiveIntent: "非交互模式：使用默认意图。",
    llmSystemPromptLabel: "LLM 系统提示：",
    llmRequestPayloadLabel: "LLM 请求负载：",
    fieldHeading: "字段",
    detailsHeading: "详情",
    fileLabel: "文件",
    printerLabel: "打印机",
    bedLabel: "热床",
    filamentLabel: "耗材",
    layoutLabel: "布局",
    profileLabel: "配置",
    processLabel: "流程",
    unknownValue: "未知",
    profileUnknown: "未知",
    layoutCounts: "{plates} 个平台 · {objects} 个模型",
    projectSummaryTitle: "项目概览",
    processLayerDetail: "层高 {value}mm",
    processWallsDetail: "壁数 {value}",
    processInfillDetail: "填充 {value}%",
    noChangesApplied: "未应用任何更改 —— 您的设置已经最优！",
    suggestedChangeSingular: "建议的更改",
    suggestedChangePlural: "建议的更改",
    parameterHeading: "参数",
    changeHeading: "变化",
    reasonHeading: "原因",
    strategyTitle: "策略",
    warningsTitle: "警告",
    objectLabel: "模型",
    selectGoalPrompt: "选择优化目标",
    notesPromptLabel: "添加关于模型的备注（几何、材料特性、期望结果）",
    skipHint: "按 Enter 跳过",
    selectedLabel: "已选择：",
    goalBalancedLabel: "平衡",
    goalBalancedDesc: "在质量、强度和速度之间取得平衡",
    goalFunctionalLabel: "强度优先",
    goalFunctionalDesc: "最大化耐久性和承重能力",
    goalVisualLabel: "外观优先",
    goalVisualDesc: "最佳表面质量和外观",
    goalDraftLabel: "草稿 / 速度",
    goalDraftDesc: "快速打印用于原型",
    goalCustomLabel: "自定义",
    goalCustomDesc: "没有预设，完全按照你的备注和限制来优化。",
    unknownParameterWarning: "未知参数 {parameter}，已跳过。",
    objectNotFoundWarning: "未找到对象 {object}，无法应用 {parameter}。",
    unknownObjectParameterWarning: "对象 {object} 的参数 {parameter} 未知。",
    relativeChangeTypeWarning: "相对更改 {parameter} 已跳过：需要数字。",
    userSettingLockedWarning: "跳过 {parameter}：该设置由用户修改并已保护。",
  },
};

const FALLBACK_LANGUAGE = "en";

/**
 * Normalize language input to a supported code.
 *
 * @param {string | undefined} language
 * @returns {string}
 */
export function normalizeLanguage(language) {
  if (!language || typeof language !== "string") return FALLBACK_LANGUAGE;
  const lower = language.toLowerCase();
  if (translations[lower]) return lower;
  const base = lower.split(/[-_]/)[0];
  if (translations[base]) return base;
  return FALLBACK_LANGUAGE;
}

/**
 * Build a lightweight i18n helper.
 *
 * @param {string} [language]
 * @returns {{ language: string, t: (key: string, vars?: Record<string, string | number>) => string }}
 */
export function createI18n(language) {
  const lang = normalizeLanguage(language);
  const dictionary = translations[lang];
  const fallback = translations[FALLBACK_LANGUAGE];

  return {
    language: lang,
    t: (key, vars = {}) => {
      const template = dictionary[key] ?? fallback[key] ?? key;
      return template.replace(/\{(\w+)\}/g, (_, name) =>
        vars[name] === undefined ? `{${name}}` : String(vars[name]),
      );
    },
  };
}

export const SUPPORTED_LANGUAGES = Object.keys(translations);
